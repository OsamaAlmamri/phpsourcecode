<?phpnamespace Scabish\Core;use SCS;/** * Scabish\Core\View * 视图类 *  * @author keluo <keluo@focrs.com> * @copyright 2016 Focrs, Co.,Ltd * @package Scabish * @since 2015-01-24 */
class View {
         private $_variables = [];    
    public function __construct() {}        public function __set($variable, $value) {        $this->_variables[$variable] = $value;    }        public function __get($variable) {        return isset($this->_variables[$variable]) ? $this->_variables[$variable] : null;    }        /**     * 渲染视图     * @param array $variables      * @param string $view     * @param boolean $output 是否立即输出     * @throws Exception     */    public function Render($variables = array(), $view = '', $output = true) {        $this->_variables = $variables;        if($view == '') {            $viewPath = $this->GetViewPath().'/'.SCS::Request()->route.'.php';        } elseif(strpos($view, '/')) {            $viewPath = $this->GetViewPath().'/'.$view.'.php';        } else {            $viewPath = $this->GetViewPath().'/'.SCS::Request()->control.'/'.$view.'.php';        }                if(file_exists($viewPath) && is_file($viewPath)) {            ob_start('ob_gzhandler') || ob_start();            require $viewPath;            $data = ob_get_clean();            if($output) {                $data = gzencode($data, 9);                header("Content-Encoding: gzip");                header("Vary: Accept-Encoding");                header("Content-Length: ".strlen($data));                echo $data;            } else return $data;        } else {            throw new \Exception('View file does not exist: '.$viewPath);        }    }        /**     * 加载视图小组件     * @param string $view     * @param array $variables 传递给组件的变量     * @throws Exception     */    public function Widget($view, $variables = []) {        extract($variables);        $widgetPath = $this->GetViewPath().'/widget/'.$view.'.php';                if(file_exists($widgetPath) && is_file($widgetPath)) {            require $widgetPath;        } else {            throw new \Exception('Widget file doest not exist: '.$widgetPath);        }    }        /**     * 返回json信息     * @param boolean $status 结果状态     * @param mixed $data 返回数据     */    public function Response($status, $data = '') {        header('Content-type: application/json; charset=utf-8');        die(json_encode(array(            'status' => $status ? 1 : 0, // 成功状态码            'data' => $data, // 数据        )));    }        private function GetViewPath() {        return SCS::Instance()->app.'/view';    }
}