/** layuiAdmin.std-v1.2.1 LPPL License By http://www.layui.com/admin/ */
 ;"use strict";layui.define(["layer","form"],function(e){var t=layui.jquery,a=layui.form,s=new Object;a.on("checkbox(goods_spec)",function(e){p.Creat_Table()}),t(".goods_spec").on("change",".spec_alias",function(){p.Creat_Table()});var p={Creat_Table:function(){p.hebingFunction(),p.saveLastTableData();var e=t(".goods_spec .layui-form-label"),a=new Array,s=new Array,n=new Array,l=new Array,c=new Array,i=new Array,o=new Array,u=!1,r=0;if(t.each(e,function(p,d){o.push(r),r++,a.push(e.eq(p).text());var _=new Array,h=new Array,y=new Array,f=new Array,v=new Array;t(".goods_spec .input_list").eq(p).find("input[type=checkbox]:checked").each(function(){var e=t(this).attr("data-name"),a=t(this).attr("data-id"),s=t(this).attr("title"),p=t(this).parent().find("input[type=hidden]").val(),n=t(this).parent().find("input[type=text]").val();n||(n=s),_.push(e),h.push(a),y.push(s),f.push(p),v.push(n)}),s.push(_),n.push(h),l.push(y),c.push(f),i.push(v),""!=y.join()&&(u=!0)}),1==u){t("#goods_spec_table").html("");var d=t('<table class="layui-table"></table>');d.appendTo(t("#goods_spec_table"));var _=t("<thead></thead>");_.appendTo(d);var h=t("<tr></tr>");h.appendTo(_),t.each(a,function(e,a){var s=t('<th style="width:100px;">'+a+"</th>");s.appendTo(h)});var y=t("<th>市场价</th><th>销售价</th><th>库存</th><th>货号</th><th>重量</th><th>起订数量</th>");y.appendTo(h);var f=t("<tbody></tbody>");f.appendTo(d);var v=p.doExchange(s),m=p.doExchange(n),b=p.doExchange(l),g=p.doExchange(c),k=p.doExchange(i);if(k.length>0){t.each(k,function(e,a){var s=v[e].split(","),n=m[e].split(","),l=b[e].split(","),c=g[e].split(","),i=a.split(","),o=t("<tr></tr>");o.appendTo(f);var u="",r=Array();t.each(i,function(a,p){r.push(n[a]),u+='<input type="hidden" name="spec_name['+e+'][]" value="'+s[a]+'">',u+='<input type="hidden" name="spec_id['+e+'][]" value="'+n[a]+'">',u+='<input type="hidden" name="spec_value['+e+'][]" value="'+l[a]+'">',u+='<input type="hidden" name="spec_image['+e+'][]" value="'+c[a]+'">',u+='<input type="hidden" name="spec_alias['+e+'][]" value="'+p+'">';var i=t("<td>"+p+"</td>");i.appendTo(o)});var d=r.join("|");u+='<input type="hidden" name="spec_table_ids_key['+e+']" value="'+d+'">';var _=t('[name="sku_code"]').val()+"_",h=p.getLastTableData(d,"spec_sku_id"),y=p.getLastTableData(d,"spec_market_price"),k=p.getLastTableData(d,"spec_sell_price"),T=p.getLastTableData(d,"spec_stock"),w=p.getLastTableData(d,"spec_sku_code");w||(w=_+e);var x=p.getLastTableData(d,"spec_weight"),D=p.getLastTableData(d,"spec_min_buy");D||(D=1);var L="";L+='<td><input type="hidden" name="spec_sku_id['+e+']" value="'+h+'">'+u,L+='<input type="text" name="spec_market_price['+e+']" value="'+y+'" lay-verify="price" autocomplete="off" class="layui-input spec_market_price"></td>',L+='<td><input type="text" name="spec_sell_price['+e+']" value="'+k+'" lay-verify="price" autocomplete="off" class="layui-input spec_sell_price"></td>',L+='<td><input type="text" name="spec_stock['+e+']" value="'+T+'" lay-verify="number" autocomplete="off" class="layui-input spec_stock"></td>',L+='<td><input type="text" name="spec_sku_code['+e+']" value="'+w+'" lay-verify="required" lay-errormsg="货号不能为空" autocomplete="off" class="layui-input spec_sku_code"></td>',L+='<td><input type="text" name="spec_weight['+e+']" value="'+x+'" lay-verify="number" autocomplete="off" class="layui-input spec_weight"></td>',L+='<td><input type="text" name="spec_min_buy['+e+']" value="'+D+'" lay-verify="number" autocomplete="off" class="layui-input spec_min_buy"></td>',t(L).appendTo(o)});var T=t("<tr></tr>");T.appendTo(f);var w=k[0].split(","),x="";x+='<td colspan="'+w.length+'" align="right"><button type="button" class="layui-btn layui-btn-sm batch_set_value">批量修改</button></td>',x+='<td ><input type="text" autocomplete="off" class="layui-input spec_market_price"></td>',x+='<td ><input type="text" autocomplete="off" class="layui-input spec_sell_price"></td>',x+='<td ><input type="text" autocomplete="off" class="layui-input spec_stock"></td>',x+="<td ></td>",x+='<td ><input type="text" autocomplete="off" class="layui-input spec_weight"></td>',x+='<td ><input type="text" autocomplete="off" class="layui-input spec_min_buy"></td>',t(x).appendTo(T)}o.pop(),t(d).mergeCell({cols:o})}else p.setDefaultTable()},hebingFunction:function(){function e(e,a){e.data("col-content",""),e.data("col-rowspan",1),e.data("col-td",t()),e.data("trNum",t("tbody tr",e).length),t("tbody tr",e).each(function(s){var p=t("td:eq("+a+")",this),n=p.html();if(""==e.data("col-content"))e.data("col-content",n),e.data("col-td",p);else if(e.data("col-content")==n){var l=e.data("col-rowspan")+1;e.data("col-rowspan",l),p.hide(),++s==e.data("trNum")&&e.data("col-td").attr("rowspan",e.data("col-rowspan"))}else 1!=e.data("col-rowspan")&&e.data("col-td").attr("rowspan",e.data("col-rowspan")),e.data("col-td",p),e.data("col-content",p.html()),e.data("col-rowspan",1)})}function a(e){e.removeData()}t.fn.mergeCell=function(s){return this.each(function(){for(var p=s.cols,n=p.length-1;void 0!=p[n];n--)e(t(this),p[n]);a(t(this))})}},doExchange:function(e){var t=e.length;if(t>=2){for(var a=e[0],s=e[1],n=e[0].length,l=e[1].length,c=n*l,i=new Array(c),o=0,u=0;u<n;u++)for(var r=0;r<l;r++)i[o]=a[u]+","+s[r],o++;var d=new Array(t-1);if(d[0]=i,t>2)for(var _=1,u=2;u<t;u++)d[_]=e[u],_++;return p.doExchange(d)}return e[0]},saveLastTableData:function(e){if(e)s=e;else{var a=t("#goods_spec_table tr").length;a>2&&t("#goods_spec_table tr").each(function(e,p){var n=e-1;if(n>=0&&e<=a-2){var l=t(this).find('[name="spec_table_ids_key['+n+']"]').val(),c=Array();c.spec_sku_id=t(this).find('[name="spec_sku_id['+n+']"]').val(),c.spec_market_price=t(this).find('[name="spec_market_price['+n+']"]').val(),c.spec_sell_price=t(this).find('[name="spec_sell_price['+n+']"]').val(),c.spec_stock=t(this).find('[name="spec_stock['+n+']"]').val(),c.spec_sku_code=t(this).find('[name="spec_sku_code['+n+']"]').val(),c.spec_weight=t(this).find('[name="spec_weight['+n+']"]').val(),c.spec_min_buy=t(this).find('[name="spec_min_buy['+n+']"]').val(),s[l]=c}})}},getLastTableData:function(e,t){return s[e]&&s[e][t]?s[e][t]:""},setDefaultTable:function(){t("#goods_spec_table").html("");var e=t('<table class="layui-table"></table>');e.appendTo(t("#goods_spec_table"));var a=t("<thead></thead>");a.appendTo(e);var s=t("<tr></tr>");s.appendTo(a);var n=t("<th>市场价</th><th>销售价</th><th>库存</th><th>货号</th><th>重量</th><th>起订数量</th>");n.appendTo(s);var l=t("<tbody></tbody>");l.appendTo(e);var c=t("<tr></tr>");c.appendTo(l);var i=p.getLastTableData("default","spec_sku_id"),o=p.getLastTableData("default","spec_market_price"),u=p.getLastTableData("default","spec_sell_price"),r=p.getLastTableData("default","spec_stock"),d=p.getLastTableData("default","spec_sku_code");d||(d=t('[name="sku_code"]').val());var _=p.getLastTableData("default","spec_weight"),h=p.getLastTableData("default","spec_min_buy");h||(h=1);var y="";y+='<td><input type="hidden" name="spec_sku_id[0]" value="'+i+'"><input type="text" name="spec_market_price[0]" value="'+o+'" lay-verify="price" autocomplete="off" class="layui-input"></td>',y+='<td><input type="text" name="spec_sell_price[0]" value="'+u+'" lay-verify="price" autocomplete="off" class="layui-input"></td>',y+='<td><input type="text" name="spec_stock[0]" value="'+r+'" lay-verify="number" autocomplete="off" class="layui-input"></td>',y+='<td><input type="text" name="spec_sku_code[0]" value="'+d+'" lay-verify="required" lay-errormsg="货号不能为空" autocomplete="off" class="layui-input"></td>',y+='<td><input type="text" name="spec_weight[0]" value="'+_+'" lay-verify="number" autocomplete="off" class="layui-input"></td>',y+='<td><input type="text" name="spec_min_buy[0]" value="'+h+'" lay-verify="number" autocomplete="off" class="layui-input"></td>',t(y).appendTo(c)},batchSetValue:function(){var e=t(".goods_spec .batch_set_value"),a=e.closest("tr").find(".spec_market_price").val(),s=e.closest("tr").find(".spec_sell_price").val(),p=e.closest("tr").find(".spec_stock").val(),n=e.closest("tr").find(".spec_weight").val(),l=e.closest("tr").find(".spec_min_buy").val();a&&t(".goods_spec .spec_market_price").val(a),s&&t(".goods_spec .spec_sell_price").val(s),p&&t(".goods_spec .spec_stock").val(p),n&&t(".goods_spec .spec_weight").val(n),l&&t(".goods_spec .spec_min_buy").val(l),e.closest("tr").find("input").val("")}};t(function(){p.setDefaultTable()}),e("goods_sku",p)});