<?php// +----------------------------------------------------------------------// | Loadphp Framework designed by www.loadphp.com// +----------------------------------------------------------------------// | Copyright (c) 2013 http://www.loadphp.com All rights reserved.// +----------------------------------------------------------------------// | Licensed ( http://www.apache.org/licenses/LICENSE-2.0 )// +----------------------------------------------------------------------// | Author: 亓斌 <qibin0506@gmail.com>// +----------------------------------------------------------------------    /**     +------------------------------------------------------------------------------     * 自动加载类     +------------------------------------------------------------------------------     */    function __autoload($class) {        $class = ucfirst($class);        if("Smarty" == $class) {            require_once(LIBS_PATH."Smarty.class.php");        }elseif(file_exists(CORE_PATH.$class.".class.php") && is_writable(CORE_PATH.$class.".class.php")) {            require_once($class.".class.php");        }elseif(file_exists(CLASS_PATH.$class.".class.php") && is_writable(CLASS_PATH.$class.".class.php")) {            require_once($class.".class.php");        }elseif(file_exists(CONTROLER_PATH.$class.".class.php") && is_writable(CONTROLER_PATH.$class.".class.php")) {            require_once($class.".class.php");        }elseif(file_exists(MODEL_PATH.$class.".class.php") && is_writable(MODEL_PATH.$class.".class.php")) {            require_once($class.".class.php");        }elseif(file_exists(LIBS_PATH."sysplugins/".$class.".php")) {            require_once("sysplugins/".$class.".php");        }elseif(file_exists(COMMONS_PATH."class/".$class.".class.php") && is_writable(COMMONS_PATH."class/".$class.".class.php")){            require_once($class.".class.php");        }else {            header('Location:'.URL);        }    }         /**     +------------------------------------------------------------------------------     * 判断目录或index.class.php文件是否创建     +------------------------------------------------------------------------------     */    function checkDir() {        createDir(PUB_PATH);        createDir(COMMONS_PATH);        createDir(COMMONS_PATH."class/");        createDir(COMMONS_PATH."function/");        createDir(PUBLIC_PATH);        createDir(CONTROLER_PATH);        createDir(MODEL_PATH);        createDir(VIEW_PATH);        createDir(VIEW_PATH.TPL_PATH);        createDir(RUNTIME_PATH);        createDir(RUNTIME_PATH."cache/");        createDir(RUNTIME_PATH."compile/");         if(!file_exists(CONTROLER_PATH."IndexAction.class.php")) {           $index = <<<INDEX<?phpclass IndexAction extends BaseAction {    function action() {        echo "<p style='color:red;'>欢迎使用loadphp框架#^_^#</p>";    }}?>INDEX;          file_put_contents(CONTROLER_PATH."IndexAction.class.php",$index);        }                if(!file_exists(VIEW_PATH."notice")) {           $notice = <<<NOTICE<html>    <head>        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />        <title>提示消息 - LoadPHP</title>        <style type="text/css">            body { font: 75% Arail; text-align: center; }            #notice { width: 300px; background: #FFF; border: 1px solid #BBB; background: #EEE; padding: 3px;            position: absolute; left: 50%; top: 50%; margin-left: -155px; margin-top: -100px; }            #notice div { background: #FFF; padding: 30px 0 20px; font-size: 1.2em; font-weight:bold }            #notice p { background: #FFF; margin: 0; padding: 0 0 20px; }            a { color: #f00} a:hover { text-decoration: none; }        </style>    </head>    <body>        <div id="notice">                <div style="width:100%;text-align:center;padding-left:10px;padding-right:10px"><(if \$mark==1)>操作成功<(else)>操作失败<(/if)></div>                            <(if \$mark==1)>                <p style="font: italic bold 2cm cursive,serif; color:green">                    (^o^)                 </p>            <(else)>                <p style="font: italic bold 2cm cursive,serif; color:red">                    π_π                </p>            <(/if)>		            <p>                 <span id="sec" style="color:blue;font-weight:bold">3</span> 秒后自动跳转，或点击 <a href="javascript:location.href='<(\$location)>';">这里</a> 跳转<br>                 <span style="display:block;text-decoration:underline;cursor:pointer;line-height:25px" onclick="stop(this)">停止</span>                </p>         </div>                                 <script>                var seco=document.getElementById("sec");                var time=3;                var tt=setInterval(function(){                        time--;                        seco.innerHTML=time;	                        if(time<=0){                            location.href='<(\$location)>';                            return;                        }                    }, 1000);                function stop(obj){                    clearInterval(tt);                    obj.style.display="none";                }        </script>    </body></html>NOTICE;        file_put_contents(VIEW_PATH."notice",$notice);        }    }        /**     +------------------------------------------------------------------------------     * 创建目录     +------------------------------------------------------------------------------     */    function createDir($dirName) {        if(!file_exists($dirName)) {            if(mkdir($dirName)) {                echo "<p style='color:red;'>目录".$dirName."创建成功</p>";            }        }    }    /**     +------------------------------------------------------------------------------     * 实例化模型基类并设置操作表名     +------------------------------------------------------------------------------     */    function D($table) {        global $db;                if(!($db instanceof DBModel)) {            $db = new DBModel();        }                $db->table = $table;        return $db;    }        /**     +------------------------------------------------------------------------------     * 实例化自定义模型并设置操作表名     +------------------------------------------------------------------------------     */    function M($table) {        global $db;        $model = $_GET['c'].'Model';                if(!($db instanceof $model)) {            $db = new $model();        }                $db->table = $table;        return $db;    }        /**     +------------------------------------------------------------------------------     * 根据参数实例化类和调用方法     +------------------------------------------------------------------------------     */    function load() {        $action = $_GET['c'].'Action';                $$action = new $action();        if(!method_exists($$action,$_GET['a'])) {            header('Location:'.URL);        }        $$action->$_GET['a']();    }        /**     +------------------------------------------------------------------------------     * 取得客户端IP     +------------------------------------------------------------------------------     */    function get_client_ip(){       if (getenv("HTTP_CLIENT_IP") && strcasecmp(getenv("HTTP_CLIENT_IP"), "unknown"))           $ip = getenv("HTTP_CLIENT_IP");       else if (getenv("HTTP_X_FORWARDED_FOR") && strcasecmp(getenv("HTTP_X_FORWARDED_FOR"), "unknown"))           $ip = getenv("HTTP_X_FORWARDED_FOR");       else if (getenv("REMOTE_ADDR") && strcasecmp(getenv("REMOTE_ADDR"), "unknown"))           $ip = getenv("REMOTE_ADDR");       else if (isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], "unknown"))           $ip = $_SERVER['REMOTE_ADDR'];       else           $ip = "unknown";       return($ip);    }        /**     +------------------------------------------------------------------------------     * 打印内容     +------------------------------------------------------------------------------     */    function p() {        $args = func_get_args();        foreach($args as $key=>$val) {            if(is_numeric($val) || is_string($val)) {                echo $val;            }else {                print_r($val);            }        }    }?>