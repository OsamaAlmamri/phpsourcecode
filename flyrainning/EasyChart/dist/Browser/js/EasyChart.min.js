"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function o(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,i,e){return i&&o(t.prototype,i),e&&o(t,e),t}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var EC_Group=function(){function i(){_classCallCheck(this,i),this.count=0,this.item=[];var t=this;window.addEventListener("resize",function(){t.resize()})}return _createClass(i,[{key:"addItem",value:function(t){this.item.push(t),this.count=this.item.length}},{key:"add",value:function(t){var i=new EasyChart(t);return this.addItem(i),i}},{key:"get",value:function(t){return this.getByID(t)}},{key:"getByID",value:function(e){var o;return this.item.forEach(function(t,i){t.opt.id==e&&(o=t)}),o}},{key:"getByIndex",value:function(t){return this.item[t]}},{key:"resize",value:function(){this.item.forEach(function(t,i){t.resize()})}}]),i}();window&&!window.EC&&(window.EC=new EC_Group);var EasyChart=function(){function e(t){_classCallCheck(this,e);var i={};"object"==("undefined"==typeof EasyChart_config?"undefined":_typeof(EasyChart_config))&&(i=EasyChart_config),this.opt=Object.assign({id:"",echarts_style:"macarons",loading_text:"loading ...",uri:"/api/",post:!1,width:"",height:"",debug:!1,use_websocket:!1},i),this.echarts=!1,this.DOM=!1,this.init(t)}return _createClass(e,[{key:"debug",value:function(t){this.opt.debug=!!t}},{key:"setOpt",value:function(t){t=t||{},this.opt=Object.assign(this.opt,t)}},{key:"on",value:function(t,i){var e=!1;"function"==typeof i?e=i:"string"==typeof i&&(e=new Function("data",i)),this.echarts.on(t,e)}},{key:"init",value:function(t){if(this.setOpt(t),this.log("init option:",t),!this.echarts)if(this.opt.id){if(this.DOM=jQuery("#"+this.opt.id),this.DOM.html(""),this.size(),this.echarts=echarts.init(document.getElementById(this.opt.id),this.opt.echarts_style),this.echarts.showLoading({text:this.opt.loading_text}),"function"==typeof this.opt.onload&&this.opt.onload(this),this.opt.on)for(var i in this.opt.on)this.on(i,this.opt.on[i])}else this.log("No id for DOM")}},{key:"send",value:function(t,i){this.opt.use_websocket||("string"==typeof t&&(t=jQuery(t).serialize()),this.ajax(this.opt.api,t,i))}},{key:"ajax",value:function(t,i,e){var o=this;"object"!=(void 0===i?"undefined":_typeof(i))&&(i={data:i}),i.EC_api=t,o.log("Send Ajax:",i),jQuery.ajax({type:"POST",timeout:6e5,url:this.opt.uri,data:i,success:e,error:function(t,i,e){o.msg("与服务器链接失败，请重试 : "+i+"  "+e,!0)}})}},{key:"msg",value:function(t){t?this.echarts.showLoading({text:t}):this.echarts.hideLoading()}},{key:"size",value:function(t,i){t&&(this.opt.width=t),i&&(this.opt.height=i),this.opt.width&&this.DOM.css({width:this.opt.width}),this.opt.height&&this.DOM.css({height:this.opt.height}),this.resize()}},{key:"resize",value:function(){this.echarts&&this.echarts.resize()}},{key:"load",value:function(t,i){this.echarts?i&&this.init(i):this.init(i);var o=this,e=t||this.opt.post||"";this.send(e,function(t){if(o.log("Recive(raw):",t),"string"==typeof t&&(t=JSON.parse(t)),o.log("Recive(obj):",t),t.result){var i={};t.data&&(i=new Function("EasyChart",t.data)(o)),o.log("option by recive",i),o.opt.debug&&(window.EC_Debug_opt=i,window.EC_Debug_chart=o.echarts),o.echarts.setOption(i),o.echarts.hideLoading()}else{t.msg||t.data;var e=t.msg||t.data||t.message||"";o.msg(e)}})}},{key:"log",value:function(t,i){this.opt.debug&&console.log("EasyChart "+t,i)}}]),e}();function EC_UUID(t,i){var e,o,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(i=i||a.length,t)for(e=0;e<t;e++)n[e]=a[0|Math.random()*i];else for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",e=0;e<36;e++)n[e]||(o=0|16*Math.random(),n[e]=a[19==e?3&o|8:o]);return n.join("")}function EC_ID(t){return(t=t||"ID")+"_"+EC_UUID(10)}jQuery(function(u){u("[EasyChart]").each(function(t){var i={},e=u(this).data("opt");e&&(i="object"==(void 0===e?"undefined":_typeof(e))?e:JSON.parse(e));var o=u(this).attr("id");o||(o=i.id||EC_ID("EasyChart"),u(this).attr("id",o)),i.id=o;var a=u(this).data("api");a&&(i.api=a),u(this).data("height")&&(i.height=a),u(this).data("width")&&(i.width=a),u(this).data("debug")&&(i.debug=!0);var n=u(this).data("onload");n&&"function"==typeof window[n]&&(i.onload=window[n]),window.EasyChart_delaytime=1;var s=parseInt(u(this).data("delay"));s||(i.delay?s=i.delay:(s=window.EasyChart_delaytime,window.EasyChart_delaytime+=300));var h=u(this).data("post");h&&(i.post="object"==(void 0===h?"undefined":_typeof(h))?h:JSON.parse(h));var r=window.EC.add(i);u(this).data("EasyChart",r),window.setTimeout(function(){r.load()},s)})});