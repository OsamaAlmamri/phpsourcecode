(function(c){"object"==typeof exports&&"object"==typeof module?c(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../smarty/smarty")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../smarty/smarty"],c):c(CodeMirror)})(function(c){c.defineMode("smartymixed",function(e){var f=c.getMode(e,"htmlmixed"),g=c.getMode(e,"smarty"),l="}",h="{";e.hasOwnProperty("leftDelimiter")&&(h=e.leftDelimiter);e.hasOwnProperty("rightDelimiter")&&
(l=e.rightDelimiter);e=h.replace(/[^\s\w]/g,"\\$&");var n=l.replace(/[^\s\w]/g,"\\$&"),p=new RegExp("^"+n+"\\*"),q=new RegExp(e+"literal"+n),r=new RegExp(e+"/literal"+n),t=new RegExp(".*"+e),u=new RegExp("[^<>]*"+e),m={chain:function(b,a,d){a.tokenize=d;return d(b,a)},cleanChain:function(b,a,d){a.tokenize=null;a.localState=null;a.localMode=null;return"string"==typeof d?d?d:null:d(b,a)},maybeBackup:function(b,a,d){var c=b.current(),e=c.search(a);-1<e?b.backUp(c.length-e):c.match(/<\/?$/)&&(b.backUp(c.length),
b.match(a,!1)||b.match(c[0]));return d}},k={html:function(b,a){var d=a.htmlMixedState.htmlState.context&&a.htmlMixedState.htmlState.context.tagName?a.htmlMixedState.htmlState.context.tagName:null;return!a.inLiteral&&b.match(u,!1)&&null===d||!a.inLiteral&&b.match(h,!1)?(a.tokenize=k.smarty,a.localMode=g,a.localState=g.startState(f.indent(a.htmlMixedState,"")),m.maybeBackup(b,h,g.token(b,a.localState))):f.token(b,a.htmlMixedState)},smarty:function(b,a){if(b.match(h,!1)){if(b.match(p,!1))return m.chain(b,
a,k.inBlock("comment","*"+l))}else if(b.match(l,!1))return b.eat(l),a.tokenize=k.html,a.localMode=f,a.localState=a.htmlMixedState,"tag";return m.maybeBackup(b,l,g.token(b,a.localState))},inBlock:function(b,a){return function(d,c){for(;!d.eol();){if(d.match(a)){m.cleanChain(d,c,"");break}d.next()}return b}}};return{startState:function(){var b=f.startState();return{token:k.html,localMode:null,localState:null,htmlMixedState:b,tokenize:null,inLiteral:!1}},copyState:function(b){var a=null,d=b.tokenize||
b.token;b.localState&&(a=c.copyState(d!=k.html?g:f,b.localState));return{token:b.token,tokenize:b.tokenize,localMode:b.localMode,localState:a,htmlMixedState:c.copyState(f,b.htmlMixedState),inLiteral:b.inLiteral}},token:function(b,a){if(b.match(h,!1)){if(!a.inLiteral&&b.match(q,!0))return a.inLiteral=!0,"keyword";if(a.inLiteral&&b.match(r,!0))return a.inLiteral=!1,"keyword"}a.inLiteral&&a.localState!=a.htmlMixedState&&(a.tokenize=k.html,a.localMode=f,a.localState=a.htmlMixedState);return(a.tokenize||
a.token)(b,a)},indent:function(b,a){return b.localMode==g||b.inLiteral&&!b.localMode||t.test(a)?c.Pass:f.indent(b.htmlMixedState,a)},innerMode:function(b){return{state:b.localState||b.htmlMixedState,mode:b.localMode||f}}}},"htmlmixed","smarty");c.defineMIME("text/x-smarty","smartymixed")});