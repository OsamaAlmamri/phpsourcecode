(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],h):h(CodeMirror)})(function(h){h.defineMode("markdown",function(t,e){function n(b,a,c){a.f=a.inline=c;return c(b,a)}function u(b){b.linkTitle=!1;b.em=!1;b.strong=!1;b.strikethrough=!1;b.quote=0;p||b.f!=q||(b.f=k,b.block=l);b.trailingSpace=0;b.trailingSpaceNewLine=!1;b.thisLineHasContent=
!1;return null}function l(b,a){var c=b.sol(),d=!1!==a.list;!1!==a.list&&0<=a.indentationDiff?(4>a.indentationDiff&&(a.indentation-=a.indentationDiff),a.list=null):!1!==a.list&&0<a.indentation?(a.list=null,a.listDepth=Math.floor(a.indentation/4)):!1!==a.list&&(a.list=!1,a.listDepth=0);var g=null;return 4<=a.indentationDiff?(a.indentation-=4,b.skipToEnd(),"comment"):b.eatSpace()?null:(g=b.match(C))?(a.header=6>=g[0].length?g[0].length:6,e.highlightFormatting&&(a.formatting="header"),a.f=a.inline,f(a)):
a.prevLineHasContent&&(g=b.match(D))?(a.header="="==g[0].charAt(0)?1:2,e.highlightFormatting&&(a.formatting="header"),a.f=a.inline,f(a)):b.eat(">")?(a.indentation++,a.quote=c?1:a.quote+1,e.highlightFormatting&&(a.formatting="quote"),b.eatSpace(),f(a)):"["===b.peek()?n(b,a,E):b.match(F,!0)?"hr":a.prevLineHasContent&&!d||!b.match(v,!1)&&!b.match(w,!1)?e.fencedCodeBlocks&&b.match(/^```[ \t]*([\w+#]*)/,!0)?(c=RegExp.$1,h.findModeByName&&(d=h.findModeByName(c))&&(c=d.mime||d.mimes[0]),c=h.getMode(t,c),
a.localMode="null"==c.name?null:c,a.localMode&&(a.localState=a.localMode.startState()),a.f=a.block=G,e.highlightFormatting&&(a.formatting="code-block"),a.code=!0,f(a)):n(b,a,a.inline):(c=null,b.match(v,!0)?c="ul":(b.match(w,!0),c="ol"),a.indentation+=4,a.list=!0,a.listDepth++,e.taskLists&&b.match(x,!1)&&(a.taskList=!0),a.f=a.inline,e.highlightFormatting&&(a.formatting=["list","list-"+c]),f(a))}function q(b,a){var c=m.token(b,a.htmlState);if(p&&null===a.htmlState.tagStart&&!a.htmlState.context||a.md_inside&&
-1<b.current().indexOf(">"))a.f=k,a.block=l,a.htmlState=null;return c}function G(b,a){if(b.sol()&&b.match("```",!1))return a.localMode=a.localState=null,a.f=a.block=H,null;if(a.localMode)return a.localMode.token(b,a.localState);b.skipToEnd();return"comment"}function H(b,a){b.match("```");a.block=l;a.f=k;e.highlightFormatting&&(a.formatting="code-block");a.code=!0;var c=f(a);a.code=!1;return c}function f(b){var a=[];if(b.formatting){a.push("formatting");"string"===typeof b.formatting&&(b.formatting=
[b.formatting]);for(var c=0;c<b.formatting.length;c++)a.push("formatting-"+b.formatting[c]),"header"===b.formatting[c]&&a.push("formatting-"+b.formatting[c]+"-"+b.header),"quote"===b.formatting[c]&&(!e.maxBlockquoteDepth||e.maxBlockquoteDepth>=b.quote?a.push("formatting-"+b.formatting[c]+"-"+b.quote):a.push("error"))}if(b.taskOpen)return a.push("meta"),a.length?a.join(" "):null;if(b.taskClosed)return a.push("property"),a.length?a.join(" "):null;if(b.linkHref)return a.push("string"),a.length?a.join(" "):
null;b.strong&&a.push("strong");b.em&&a.push("em");b.strikethrough&&a.push("strikethrough");b.linkText&&a.push("link");b.code&&a.push("comment");b.header&&(a.push("header"),a.push("header-"+b.header));b.quote&&(a.push("quote"),!e.maxBlockquoteDepth||e.maxBlockquoteDepth>=b.quote?a.push("quote-"+b.quote):a.push("quote-"+e.maxBlockquoteDepth));!1!==b.list&&((c=(b.listDepth-1)%3)?1===c?a.push("variable-3"):a.push("keyword"):a.push("variable-2"));b.trailingSpaceNewLine?a.push("trailing-space-new-line"):
b.trailingSpace&&a.push("trailing-space-"+(b.trailingSpace%2?"a":"b"));return a.length?a.join(" "):null}function I(b,a){if(b.match(J,!0))return f(a)}function k(b,a){var c=a.text(b,a);if("undefined"!==typeof c)return c;if(a.list)return a.list=null,f(a);if(a.taskList)return"x"!==b.match(x,!0)[1]?a.taskOpen=!0:a.taskClosed=!0,e.highlightFormatting&&(a.formatting="task"),a.taskList=!1,f(a);a.taskOpen=!1;a.taskClosed=!1;if(a.header&&b.match(/^#+$/,!0))return e.highlightFormatting&&(a.formatting="header"),
f(a);var c=b.sol(),d=b.next();if("\\"===d&&(b.next(),e.highlightFormatting))return(c=f(a))?c+" formatting-escape":"formatting-escape";if(a.linkTitle){a.linkTitle=!1;var g=d;"("===d&&(g=")");g=(g+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");if(b.match(new RegExp("^\\s*(?:[^"+g+"\\\\]+|\\\\\\\\|\\\\.)"+g),!0))return"string"}if("`"===d){c=a.formatting;e.highlightFormatting&&(a.formatting="code");d=f(a);g=b.pos;b.eatWhile("`");g=1+b.pos-g;if(a.code){if(g===y)return a.code=!1,d;a.formatting=c}else y=g,
a.code=!0;return f(a)}if(a.code)return f(a);if("!"===d&&b.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return b.match(/\[[^\]]*\]/),a.inline=a.f=z,"tag";if("["===d&&b.match(/.*\](\(.*\)| ?\[.*\])/,!1))return a.linkText=!0,e.highlightFormatting&&(a.formatting="link"),f(a);if("]"===d&&a.linkText&&b.match(/\(.*\)| ?\[.*\]/,!1))return e.highlightFormatting&&(a.formatting="link"),c=f(a),a.linkText=!1,a.inline=a.f=z,c;if("<"===d&&b.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return a.f=a.inline=A,e.highlightFormatting&&
(a.formatting="link"),c=f(a),(c?c+" ":"")+"link";if("<"===d&&b.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return a.f=a.inline=A,e.highlightFormatting&&(a.formatting="link"),c=(c=f(a))?c+" ":"",c+"link";if("<"===d&&b.match(/^\w/,!1))return-1!=b.string.indexOf(">")&&(c=b.string.substring(1,b.string.indexOf(">")),/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(c)&&(a.md_inside=!0)),b.backUp(1),a.htmlState=h.startState(m),c=q,a.f=a.block=c,c(b,a);if("<"===d&&b.match(/^\/\w*?>/))return a.md_inside=!1,"tag";g=
!1;if(!e.underscoresBreakWords&&"_"===d&&"_"!==b.peek()&&b.match(/(\w)/,!1)){var k=b.pos-2;0<=k&&(k=b.string.charAt(k),"_"!==k&&k.match(/(\w)/,!1)&&(g=!0))}if("*"===d||"_"===d&&!g){if(!c||" "!==b.peek()){if(a.strong===d&&b.eat(d))return e.highlightFormatting&&(a.formatting="strong"),d=f(a),a.strong=!1,d;if(!a.strong&&b.eat(d))return a.strong=d,e.highlightFormatting&&(a.formatting="strong"),f(a);if(a.em===d)return e.highlightFormatting&&(a.formatting="em"),d=f(a),a.em=!1,d;if(!a.em)return a.em=d,e.highlightFormatting&&
(a.formatting="em"),f(a)}}else if(" "===d&&(b.eat("*")||b.eat("_"))){if(" "===b.peek())return f(a);b.backUp(1)}if(e.strikethrough)if("~"===d&&b.eatWhile(d)){if(a.strikethrough)return e.highlightFormatting&&(a.formatting="strikethrough"),d=f(a),a.strikethrough=!1,d;if(b.match(/^[^\s]/,!1))return a.strikethrough=!0,e.highlightFormatting&&(a.formatting="strikethrough"),f(a)}else if(" "===d&&b.match(/^~~/,!0)){if(" "===b.peek())return f(a);b.backUp(2)}" "===d&&(b.match(/ +$/,!1)?a.trailingSpace++:a.trailingSpace&&
(a.trailingSpaceNewLine=!0));return f(a)}function A(b,a){if(">"===b.next()){a.f=a.inline=k;e.highlightFormatting&&(a.formatting="link");var c=f(a);return(c?c+" ":"")+"link"}b.match(/^[^>]+/,!0);return"link"}function z(b,a){if(b.eatSpace())return null;var c=b.next();return"("===c||"["===c?(a.f=a.inline=K("("===c?")":"]"),e.highlightFormatting&&(a.formatting="link-string"),a.linkHref=!0,f(a)):"error"}function K(b){return function(a,c){if(a.next()===b){c.f=c.inline=k;e.highlightFormatting&&(c.formatting=
"link-string");var d=f(c);c.linkHref=!1;return d}a.match(L(b),!0)&&a.backUp(1);c.linkHref=!0;return f(c)}}function E(b,a){return b.match(/^[^\]]*\]:/,!1)?(a.f=M,b.next(),e.highlightFormatting&&(a.formatting="link"),a.linkText=!0,f(a)):n(b,a,k)}function M(b,a){if(b.match(/^\]:/,!0)){a.f=a.inline=N;e.highlightFormatting&&(a.formatting="link");var c=f(a);a.linkText=!1;return c}b.match(/^[^\]]+/,!0);return"link"}function N(b,a){if(b.eatSpace())return null;b.match(/^[^\s]+/,!0);void 0===b.peek()?a.linkTitle=
!0:b.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0);a.f=a.inline=k;return"string"}function L(b){r[b]||(b=(b+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),r[b]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+b+")"));return r[b]}var p=h.modes.hasOwnProperty("xml"),m=h.getMode(t,p?{name:"xml",htmlMode:!0}:"text/plain");void 0===e.highlightFormatting&&(e.highlightFormatting=!1);void 0===e.maxBlockquoteDepth&&(e.maxBlockquoteDepth=0);void 0===e.underscoresBreakWords&&
(e.underscoresBreakWords=!0);void 0===e.fencedCodeBlocks&&(e.fencedCodeBlocks=!1);void 0===e.taskLists&&(e.taskLists=!1);void 0===e.strikethrough&&(e.strikethrough=!1);var y=0,F=/^([*\-=_])(?:\s*\1){2,}\s*$/,v=/^[*\-+]\s+/,w=/^[0-9]+\.\s+/,x=/^\[(x| )\](?=\s)/,C=/^#+/,D=/^(?:\={1,}|-{1,})$/,J=/^[^#!\[\]*_\\<>` "'(~]+/,r=[],B={startState:function(){return{f:l,prevLineHasContent:!1,thisLineHasContent:!1,block:l,htmlState:null,indentation:0,inline:k,text:I,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,
em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1}},copyState:function(b){return{f:b.f,prevLineHasContent:b.prevLineHasContent,thisLineHasContent:b.thisLineHasContent,block:b.block,htmlState:b.htmlState&&h.copyState(m,b.htmlState),indentation:b.indentation,localMode:b.localMode,localState:b.localMode?h.copyState(b.localMode,b.localState):null,inline:b.inline,text:b.text,formatting:!1,linkTitle:b.linkTitle,em:b.em,strong:b.strong,
strikethrough:b.strikethrough,header:b.header,taskList:b.taskList,list:b.list,listDepth:b.listDepth,quote:b.quote,trailingSpace:b.trailingSpace,trailingSpaceNewLine:b.trailingSpaceNewLine,md_inside:b.md_inside}},token:function(b,a){a.formatting=!1;if(b.sol()){var c=!!a.header;a.header=0;if(b.match(/^\s*$/,!0)||c)return a.prevLineHasContent=!1,u(a),c?this.token(b,a):null;a.prevLineHasContent=a.thisLineHasContent;a.thisLineHasContent=!0;a.taskList=!1;a.code=!1;a.trailingSpace=0;a.trailingSpaceNewLine=
!1;a.f=a.block;var c=b.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,d=4*Math.floor((c-a.indentation)/4);4<d&&(d=4);d=a.indentation+d;a.indentationDiff=d-a.indentation;a.indentation=d;if(0<c)return null}return a.f(b,a)},innerMode:function(b){return b.block==q?{state:b.htmlState,mode:m}:b.localState?{state:b.localState,mode:b.localMode}:{state:b,mode:B}},blankLine:u,getType:f,fold:"markdown"};return B},"xml");h.defineMIME("text/x-markdown","markdown")});