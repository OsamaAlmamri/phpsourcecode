(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function v(a,b){function c(a){if(!d.parentNode)return e.off(document,"mousemove",c);d.style.top=Math.max(0,a.clientY-d.offsetHeight-5)+"px";d.style.left=a.clientX+5+"px"}var d=document.createElement("div");d.className="CodeMirror-lint-tooltip";d.appendChild(b.cloneNode(!0));document.body.appendChild(d);
e.on(document,"mousemove",c);c(a);null!=d.style.opacity&&(d.style.opacity=1);return d}function w(a){a.parentNode&&(null==a.style.opacity&&a.parentNode&&a.parentNode.removeChild(a),a.style.opacity=0,setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a)},600))}function l(a,b,c){function d(){e.off(c,"mouseout",d);f&&(w(f),f=null)}var f=v(a,b),g=setInterval(function(){if(f)for(var a=c;;a=a.parentNode){a&&11==a.nodeType&&(a=a.host);if(a==document.body)return;if(!a){d();break}}if(!f)return clearInterval(g)},
400);e.on(c,"mouseout",d)}function x(a,b,c){this.marked=[];this.options=b;this.timeout=null;this.hasGutter=c;this.onMouseOver=function(b){a:{var c=b.target||b.srcElement;if(/\bCodeMirror-lint-mark-/.test(c.className))for(var c=c.getBoundingClientRect(),g=a.findMarksAt(a.coordsChar({left:(c.left+c.right)/2,top:(c.top+c.bottom)/2},"client")),e=0;e<g.length;++e)if(c=g[e].__annotation){g=b.target||b.srcElement;l(b,p(c),g);break a}}}}function q(a){var b=a.state.lint;b.hasGutter&&a.clearGutter("CodeMirror-lint-markers");
for(a=0;a<b.marked.length;++a)b.marked[a].clear();b.marked.length=0}function y(a,b,c,d){var f=document.createElement("div"),g=f;f.className="CodeMirror-lint-marker-"+b;c&&(g=f.appendChild(document.createElement("div")),g.className="CodeMirror-lint-marker-multiple");if(0!=d)e.on(g,"mouseover",function(b){l(b,a,g)});return f}function p(a){var b=a.severity;b||(b="error");var c=document.createElement("div");c.className="CodeMirror-lint-message-"+b;c.appendChild(document.createTextNode(a.message));return c}
function r(a){var b=a.state.lint.options,c=b.options||b;b.async||b.getAnnotations.async?b.getAnnotations(a.getValue(),t,c,a):t(a,b.getAnnotations(a.getValue(),c,a))}function t(a,b){q(a);for(var c=a.state.lint,d=c.options,f=[],g=0;g<b.length;++g){var e=b[g],k=e.from.line;(f[k]||(f[k]=[])).push(e)}for(g=0;g<f.length;++g)if(e=f[g]){for(var k=null,l=c.hasGutter&&document.createDocumentFragment(),n=0;n<e.length;++n){var h=e[n],m=h.severity;m||(m="error");"error"!=k&&(k=m);d.formatAnnotation&&(h=d.formatAnnotation(h));
c.hasGutter&&l.appendChild(p(h));h.to&&c.marked.push(a.markText(h.from,h.to,{className:"CodeMirror-lint-mark-"+m,__annotation:h}))}c.hasGutter&&a.setGutterMarker(g,"CodeMirror-lint-markers",y(l,k,1<e.length,c.options.tooltips))}if(d.onUpdateLinting)d.onUpdateLinting(b,f,a)}function u(a){var b=a.state.lint;clearTimeout(b.timeout);b.timeout=setTimeout(function(){r(a)},b.options.delay||500)}e.defineOption("lint",!1,function(a,b,c){c&&c!=e.Init&&(q(a),a.off("change",u),e.off(a.getWrapperElement(),"mouseover",
a.state.lint.onMouseOver),delete a.state.lint);if(b){var d=a.getOption("gutters");c=!1;for(var f=0;f<d.length;++f)"CodeMirror-lint-markers"==d[f]&&(c=!0);d=a.state;if(b instanceof Function)b={getAnnotations:b};else if(b&&!0!==b||(b={}),b.getAnnotations||(b.getAnnotations=a.getHelper(e.Pos(0,0),"lint")),!b.getAnnotations)throw Error("Required option 'getAnnotations' missing (lint addon)");c=d.lint=new x(a,b,c);a.on("change",u);if(0!=c.options.tooltips)e.on(a.getWrapperElement(),"mouseover",c.onMouseOver);
r(a)}})});