(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],e):e(CodeMirror)})(function(e){function t(a){this.options=a;this.from=this.to=0}function n(a){if("string"==typeof a){var b=document.createElement("div");b.className=a+" CodeMirror-guttermarker-subtle";return b}return a.cloneNode(!0)}function h(a,b,d){var c=a.state.foldGutter.options,e=b,k=a.foldOption(c,
"minFoldSize"),h=a.foldOption(c,"rangeFinder");a.eachLine(b,d,function(b){var d=null,f;a:{f=e;for(var g=a.findMarksAt(m(f)),l=0;l<g.length;++l)if(g[l].__isFold&&g[l].find().from.line==f){f=!0;break a}f=void 0}f?d=n(c.indicatorFolded):(f=m(e,0),(f=h&&h(a,f))&&f.to.line-f.from.line>=k&&(d=n(c.indicatorOpen)));a.setGutterMarker(b,c.gutter,d);++e})}function k(a){var b=a.getViewport(),d=a.state.foldGutter;d&&(a.operation(function(){h(a,b.from,b.to)}),d.from=b.from,d.to=b.to)}function p(a,b,d){var c=a.state.foldGutter;
c&&(c=c.options,d==c.gutter&&a.foldCode(m(b,0),c.rangeFinder))}function q(a){var b=a.state.foldGutter;if(b){var d=b.options;b.from=b.to=0;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){k(a)},d.foldOnChangeTimeSpan||600)}}function r(a){var b=a.state.foldGutter;if(b){var d=b.options;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){var c=a.getViewport();b.from==b.to||20<c.from-b.to||20<b.from-c.to?k(a):a.operation(function(){c.from<b.from&&(h(a,c.from,b.from),b.from=
c.from);c.to>b.to&&(h(a,b.to,c.to),b.to=c.to)})},d.updateViewportTimeSpan||400)}}function g(a,b){var d=a.state.foldGutter;if(d){var c=b.line;c>=d.from&&c<d.to&&h(a,c,c+1)}}e.defineOption("foldGutter",!1,function(a,b,d){d&&d!=e.Init&&(a.clearGutter(a.state.foldGutter.options.gutter),a.state.foldGutter=null,a.off("gutterClick",p),a.off("change",q),a.off("viewportChange",r),a.off("fold",g),a.off("unfold",g),a.off("swapDoc",k));b&&(d=a.state,!0===b&&(b={}),null==b.gutter&&(b.gutter="CodeMirror-foldgutter"),
null==b.indicatorOpen&&(b.indicatorOpen="CodeMirror-foldgutter-open"),null==b.indicatorFolded&&(b.indicatorFolded="CodeMirror-foldgutter-folded"),d.foldGutter=new t(b),k(a),a.on("gutterClick",p),a.on("change",q),a.on("viewportChange",r),a.on("fold",g),a.on("unfold",g),a.on("swapDoc",k))});var m=e.Pos});