(function(k){"object"==typeof exports&&"object"==typeof module?k(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],k):k(CodeMirror)})(function(k){function B(a){a=a.doc.modeOption;"sql"===a&&(a="text/x-sql");return k.resolveMode(a).keywords}function u(a){return"string"==typeof a?a:a.text}function r(a,c){if(!a.slice)return a[c];for(var b=a.length-1;0<=b;b--)if(u(a[b])==c)return a[b]}function z(a){var c=
{},b;for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c}function m(a,c,b,d){for(var e in b)if(b.hasOwnProperty(e)){Array.isArray(b)&&(e=b[e]);var g=c,h=g.length,h=u(e).substr(0,h);g.toUpperCase()===h.toUpperCase()&&a.push(d(e))}}function C(a){"."==a.charAt(0)&&(a=a.substr(1));return a.replace(/`/g,"")}function v(a){for(var c=u(a).split("."),b=0;b<c.length;b++)c[b]="`"+c[b]+"`";c=c.join(".");if("string"==typeof a)return c;a=z(a);a.text=c;return a}function D(a,c,b,d){for(var e=!1,g=[],h=c.start,f=
!0;f;)f="."==c.string.charAt(0),e=e||"`"==c.string.charAt(0),h=c.start,g.unshift(C(c.string)),c=d.getTokenAt(l(a.line,c.start)),"."==c.string&&(f=!0,c=d.getTokenAt(l(a.line,c.start)));a=g.join(".");m(b,a,q,function(a){return e?v(a):a});m(b,a,w,function(a){return e?v(a):a});a=g.pop();var n=g.join(".");r(q,n)||(n=E(n,d));(d=r(q,n))&&Array.isArray(q)&&d.columns&&(d=d.columns);d&&m(b,a,d,function(a){"string"==typeof a?a=n+"."+a:(a=z(a),a.text=n+"."+a.text);return e?v(a):a});return h}function F(a,c){if(a)for(var b=
/[,;]/g,d=a.split(" "),e=0;e<d.length;e++)c(d[e]?d[e].replace(b,""):"")}function A(a){return a.line+a.ch/Math.pow(10,6)}function E(a,c){for(var b=c.doc,d=b.getValue(),e=a.toUpperCase(),g="",h="",f=[],n=l(0,0),k=l(c.lastLine(),c.getLineHandle(c.lastLine()).length),p=d.indexOf(x.QUERY_DIV);-1!=p;)f.push(b.posFromIndex(p)),p=d.indexOf(x.QUERY_DIV,p+1);f.unshift(l(0,0));f.push(l(c.lastLine(),c.getLineHandle(c.lastLine()).text.length));for(var p=0,m=A(c.getCursor()),d=0;d<f.length;d++){var t=A(f[d]);if(m>
p&&m<=t){n=l(Math.floor(p),+p.toString().split(".").pop());k=l(Math.floor(t),+t.toString().split(".").pop());break}p=t}b=b.getRange(n,k,!1);for(d=0;d<b.length&&(F(b[d],function(a){var b=a.toUpperCase();b===e&&r(q,g)&&(h=g);b!==x.ALIAS_KEYWORD&&(g=a)}),!h);d++);return h}var q,w,y,x={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},l=k.Pos;k.registerHelper("hint","sql",function(a,c){q=c&&c.tables||{};var b=c&&c.defaultTable;w=b&&r(q,b)||[];y=y||B(a);var b=a.getCursor(),d=[],e=a.getTokenAt(b),g,h,f;e.end>b.ch&&(e.end=
b.ch,e.string=e.string.slice(0,b.ch-e.start));e.string.match(/^[.`\w@]\w*$/)?(f=e.string,g=e.start,h=e.end):(g=h=b.ch,f="");"."==f.charAt(0)||"`"==f.charAt(0)?g=D(b,e,d,a):(m(d,f,q,function(a){return a}),m(d,f,w,function(a){return a}),m(d,f,y,function(a){return a.toUpperCase()}));return{list:d,from:l(b.line,g),to:l(b.line,h)}})});