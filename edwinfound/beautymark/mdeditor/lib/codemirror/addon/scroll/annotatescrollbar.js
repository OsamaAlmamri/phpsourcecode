(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function e(a,g){function b(a){clearTimeout(c.doRedraw);c.doRedraw=setTimeout(function(){c.redraw()},a)}this.cm=a;this.options=g;this.buttonHeight=g.scrollButtonHeight||a.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=a.getWrapperElement().appendChild(document.createElement("div"));
this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();var c=this;a.on("refresh",this.resizeHandler=function(){clearTimeout(c.doUpdate);c.doUpdate=setTimeout(function(){c.computeScale()&&b(20)},100)});a.on("markerAdded",this.resizeHandler);a.on("markerCleared",this.resizeHandler);if(!1!==g.listenForChanges)a.on("change",this.changeHandler=function(){b(250)})}b.defineExtension("annotateScrollbar",function(a){"string"==typeof a&&(a={className:a});
return new e(this,a)});b.defineOption("scrollButtonHeight",0);e.prototype.computeScale=function(){var a=this.cm,a=(a.getWrapperElement().clientHeight-a.display.barHeight-2*this.buttonHeight)/a.heightAtLine(a.lastLine()+1,"local");if(a!=this.hScale)return this.hScale=a,!0};e.prototype.update=function(a){this.annotations=a;this.redraw()};e.prototype.redraw=function(a){!1!==a&&this.computeScale();a=this.cm;var b=this.hScale,e=document.createDocumentFragment(),c=this.annotations;if(a.display.barWidth)for(var f=
0,h;f<c.length;f++){for(var d=c[f],k=h||a.charCoords(d.from,"local").top*b,d=a.charCoords(d.to,"local").bottom*b;f<c.length-1;){h=a.charCoords(c[f+1].from,"local").top*b;if(h>d+.9)break;d=c[++f];d=a.charCoords(d.to,"local").bottom*b}if(d!=k){var d=Math.max(d-k,3),l=e.appendChild(document.createElement("div"));l.style.cssText="position: absolute; right: 0px; width: "+Math.max(a.display.barWidth-1,2)+"px; top: "+(k+this.buttonHeight)+"px; height: "+d+"px";l.className=this.options.className}}this.div.textContent=
"";this.div.appendChild(e)};e.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);this.changeHandler&&this.cm.off("change",this.changeHandler);this.div.parentNode.removeChild(this.div)}});