(function(f){"object"==typeof exports&&"object"==typeof module?f(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],f):f(CodeMirror)})(function(f){function p(f,b){var a=f.getRange(l(b.line,b.ch-1),l(b.line,b.ch+1));return 2==a.length?a:null}function r(h,b,a){var c=h.getLine(b.line),d=h.getTokenAt(b);if(/\bstring2?\b/.test(d.type))return!1;a=new f.StringStream(c.slice(0,b.ch)+a+c.slice(b.ch),4);for(a.pos=a.start=d.start;;){c=h.getMode().token(a,d.state);
if(a.pos>=b.ch+1)return/\bstring2?\b/.test(c);a.start=a.pos}}function t(h,b){for(var a={name:"autoCloseBrackets",Backspace:function(b){if(b.getOption("disableInput"))return f.Pass;for(var a=b.listSelections(),m=0;m<a.length;m++){if(!a[m].empty())return f.Pass;var c=p(b,a[m].head);if(!c||0!=h.indexOf(c)%2)return f.Pass}for(m=a.length-1;0<=m;m--)c=a[m].head,b.replaceRange("",l(c.line,c.ch-1),l(c.line,c.ch+1))}},c="",d=0;d<h.length;d+=2)(function(e,d){c+=d;a["'"+e+"'"]=function(a){if(a.getOption("disableInput"))return f.Pass;
for(var h=a.listSelections(),n,k,q=0;q<h.length;q++){var p=h[q],g=p.head;k=a.getRange(g,l(g.line,g.ch+1));if(p.empty())if(e==d&&k==d)k=a.getRange(g,l(g.line,g.ch+3))==e+e+e?"skipThree":"skip";else if(e==d&&1<g.ch&&0<=b.indexOf(e)&&a.getRange(l(g.line,g.ch-2),g)==e+e&&(2>=g.ch||a.getRange(l(g.line,g.ch-3),l(g.line,g.ch-2))!=e))k="addFour";else if('"'==e||"'"==e)if(!f.isWordChar(k)&&r(a,g,e))k="both";else return f.Pass;else if(a.getLine(g.line).length==g.ch||0<=c.indexOf(k)||u.test(k))k="both";else return f.Pass;
else k="surround";if(!n)n=k;else if(n!=k)return f.Pass}a.operation(function(){if("skip"==n)a.execCommand("goCharRight");else if("skipThree"==n)for(var b=0;3>b;b++)a.execCommand("goCharRight");else if("surround"==n){for(var c=a.getSelections(),b=0;b<c.length;b++)c[b]=e+c[b]+d;a.replaceSelections(c,"around")}else"both"==n?(a.replaceSelection(e+d,null),a.execCommand("goCharLeft")):"addFour"==n&&(a.replaceSelection(e+e+e+e,"before"),a.execCommand("goCharRight"))})};e!=d&&(a["'"+d+"'"]=function(a){for(var b=
a.listSelections(),c=0;c<b.length;c++){var e=b[c];if(!e.empty()||a.getRange(e.head,l(e.head.line,e.head.ch+1))!=d)return f.Pass}a.execCommand("goCharRight")})})(h.charAt(d),h.charAt(d+1));return a}function v(h){return function(b){if(b.getOption("disableInput"))return f.Pass;for(var a=b.listSelections(),c=0;c<a.length;c++){if(!a[c].empty())return f.Pass;var d=p(b,a[c].head);if(!d||0!=h.indexOf(d)%2)return f.Pass}b.operation(function(){b.replaceSelection("\n\n",null);b.execCommand("goCharLeft");a=b.listSelections();
for(var c=0;c<a.length;c++){var d=a[c].head.line;b.indentLine(d,null,!0);b.indentLine(d+1,null,!0)}})}}var u=/\s/,l=f.Pos;f.defineOption("autoCloseBrackets",!1,function(h,b,a){a!=f.Init&&a&&h.removeKeyMap("autoCloseBrackets");if(b){var c="()[]{}''\"\"",d="'\"";a="[]{}";"string"==typeof b?c=b:"object"==typeof b&&(null!=b.pairs&&(c=b.pairs),null!=b.triples&&(d=b.triples),null!=b.explode&&(a=b.explode));b=t(c,d);a&&(b.Enter=v(a));h.addKeyMap(b)}})});