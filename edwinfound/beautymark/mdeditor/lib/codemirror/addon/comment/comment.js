(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],h):h(CodeMirror)})(function(h){function x(c){c=c.search(q);return-1==c?0:c}var B={},q=/[^\s\u00a0]/,l=h.Pos;h.commands.toggleComment=function(c){for(var e=Infinity,a=c.listSelections(),d=null,b=a.length-1;0<=b;b--){var f=a[b].from(),g=a[b].to();f.line>=e||(g.line>=e&&(g=l(e,0)),e=f.line,null==d?c.uncomment(f,g)?d="un":(c.lineComment(f,
g),d="line"):"un"==d?c.uncomment(f,g):c.lineComment(f,g))}};h.defineExtension("lineComment",function(c,e,a){a||(a=B);var d=this,b=d.getModeAt(c),f=a.lineComment||b.lineComment;if(f){var g=d.getLine(c.line);if(null!=g){var m=Math.min(0!=e.ch||e.line==c.line?e.line+1:e.line,d.lastLine()+1),h=null==a.padding?" ":a.padding,k=a.commentBlankLines||c.line==e.line;d.operation(function(){if(a.indent)for(var e=g.slice(0,x(g)),b=c.line;b<m;++b){var r=d.getLine(b),p=e.length;if(k||q.test(r))r.slice(0,p)!=e&&
(p=x(r)),d.replaceRange(e+f+h,l(b,0),l(b,p))}else for(b=c.line;b<m;++b)(k||q.test(d.getLine(b)))&&d.replaceRange(f+h,l(b,0))})}}else if(a.blockCommentStart||b.blockCommentStart)a.fullLines=!0,d.blockComment(c,e,a)});h.defineExtension("blockComment",function(c,e,a){a||(a=B);var d=this,b=d.getModeAt(c),f=a.blockCommentStart||b.blockCommentStart,g=a.blockCommentEnd||b.blockCommentEnd;if(f&&g){var m=Math.min(e.line,d.lastLine());m!=c.line&&0==e.ch&&q.test(d.getLine(m))&&--m;var h=null==a.padding?" ":
a.padding;c.line>m||d.operation(function(){if(0!=a.fullLines){var k=q.test(d.getLine(m));d.replaceRange(h+g,l(m));d.replaceRange(f+h,l(c.line,0));var y=a.blockCommentLead||b.blockCommentLead;if(null!=y)for(var n=c.line+1;n<=m;++n)(n!=m||k)&&d.replaceRange(y+h,l(n,0))}else d.replaceRange(g,e),d.replaceRange(f,c)})}else(a.lineComment||b.lineComment)&&0!=a.fullLines&&d.lineComment(c,e,a)});h.defineExtension("uncomment",function(c,e,a){a||(a=B);var d=this,b=d.getModeAt(c),f=Math.min(0!=e.ch||e.line==
c.line?e.line:e.line-1,d.lastLine()),g=Math.min(c.line,f),h=a.lineComment||b.lineComment,x=[],k=null==a.padding?" ":a.padding,y;a:if(h){for(var n=g;n<=f;++n){var r=d.getLine(n),p=r.indexOf(h);-1<p&&!/comment/.test(d.getTokenTypeAt(l(n,p+1)))&&(p=-1);if(-1==p&&(n!=f||n==g)&&q.test(r))break a;if(-1<p&&q.test(r.slice(0,p)))break a;x.push(r)}d.operation(function(){for(var a=g;a<=f;++a){var c=x[a-g],b=c.indexOf(h),e=b+h.length;0>b||(c.slice(e,e+k.length)==k&&(e+=k.length),y=!0,d.replaceRange("",l(a,b),
l(a,e)))}});if(y)return!0}var v=a.blockCommentStart||b.blockCommentStart,u=a.blockCommentEnd||b.blockCommentEnd;if(!v||!u)return!1;var C=a.blockCommentLead||b.blockCommentLead,z=d.getLine(g),w=f==g?z:d.getLine(f),A=z.indexOf(v),t=w.lastIndexOf(u);-1==t&&g!=f&&(w=d.getLine(--f),t=w.lastIndexOf(u));if(-1==A||-1==t||!/comment/.test(d.getTokenTypeAt(l(g,A+1)))||!/comment/.test(d.getTokenTypeAt(l(f,t+1))))return!1;b=z.lastIndexOf(v,c.ch);a=-1==b?-1:z.slice(0,c.ch).indexOf(u,b+v.length);if(-1!=b&&-1!=a&&
a+u.length!=c.ch)return!1;a=w.indexOf(u,e.ch);c=w.slice(e.ch).lastIndexOf(v,a-e.ch);b=-1==a||-1==c?-1:e.ch+c;if(-1!=a&&-1!=b&&b!=e.ch)return!1;d.operation(function(){d.replaceRange("",l(f,t-(k&&w.slice(t-k.length,t)==k?k.length:0)),l(f,t+u.length));var a=A+v.length;k&&z.slice(a,a+k.length)==k&&(a+=k.length);d.replaceRange("",l(g,A),l(g,a));if(C)for(a=g+1;a<=f;++a){var c=d.getLine(a),b=c.indexOf(C);if(-1!=b&&!q.test(c.slice(0,b))){var e=b+C.length;k&&c.slice(e,e+k.length)==k&&(e+=k.length);d.replaceRange("",
l(a,b),l(a,e))}}});return!0})});