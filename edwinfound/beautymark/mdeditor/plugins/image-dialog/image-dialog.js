(function(){var f=function(a){a.fn.imageDialog=function(){var a=this.cm,f=this.lang,n=this.editor,b=this.settings,p=a.getCursor(),t=a.getSelection(),e=f.dialog.image,d=this.classPrefix,g=d+"image-iframe",k=d+"image-dialog",c;a.focus();var q=function(b){c.find("."+d+"dialog-mask")[b?"show":"hide"]()};if(1>n.find("."+k).length){var h=(new Date).getTime(),l=b.imageUploadURL+(0<=b.imageUploadURL.indexOf("?")?"&":"?")+"guid="+h;b.crossDomainUpload&&(l+="&callback="+b.uploadCallbackURL+"&dialog_id=editormd-image-dialog-"+
h);c=this.createDialog({title:e.title,width:b.imageUpload?465:380,height:254,name:k,content:(b.imageUpload?'<form action="'+l+'" target="'+g+'" method="post" enctype="multipart/form-data" class="'+d+'form">':'<div class="'+d+'form">')+(b.imageUpload?'<iframe name="'+g+'" id="'+g+'" guid="'+h+'"></iframe>':"")+"<label>"+e.url+'</label><input type="text" data-url />'+(b.imageUpload?'<div class="'+d+'file-input"><input type="file" name="'+d+'image-file" accept="image/*" /><input type="submit" value="'+
e.uploadButton+'" /></div>':"")+"<br/><label>"+e.alt+'</label><input type="text" value="'+t+'" data-alt /><br/><label>'+e.link+'</label><input type="text" value="http://" data-link /><br/>'+(b.imageUpload?"</form>":"</div>"),mask:b.dialogShowMask,drag:b.dialogDraggable,lockScreen:b.dialogLockScreen,maskStyle:{opacity:b.dialogMaskOpacity,backgroundColor:b.dialogMaskBgColor},buttons:{enter:[f.buttons.enter,function(){var b=this.find("[data-url]").val(),c=this.find("[data-alt]").val(),d=this.find("[data-link]").val();
if(""===b)return alert(e.imageURLEmpty),!1;var m=""!==c?' "'+c+'"':"";""===d||"http://"===d?a.replaceSelection("!["+c+"]("+b+m+")"):a.replaceSelection("[!["+c+"]("+b+m+")]("+d+m+")");""===c&&a.setCursor(p.line,p.ch+2);this.hide().lockScreen(!1).hideMask();return!1}],cancel:[f.buttons.cancel,function(){this.hide().lockScreen(!1).hideMask();return!1}]}});c.attr("id",d+"image-dialog-"+h);if(!b.imageUpload)return;var r=c.find('[name="'+d+'image-file"]');r.bind("change",function(){var a=r.val(),d=new RegExp("(\\.("+
b.imageFormats.join("|")+"))$");if(""===a)return alert(e.uploadFileEmpty),!1;if(!d.test(a.toLowerCase()))return alert(e.formatNotAllowed+b.imageFormats.join(", ")),!1;q(!0);c.find('[type="submit"]').bind("click",function(){var b=document.getElementById(g);b.onload=function(){q(!1);var a=(b.contentWindow?b.contentWindow:b.contentDocument).document.body,a=a.innerText?a.innerText:a.textContent?a.textContent:null,a="undefined"!==typeof JSON.parse?JSON.parse(a):eval("("+a+")");1===a.success?c.find("[data-url]").val(a.url):
alert(a.message);return!1}}).trigger("click")})}c=n.find("."+k);c.find('[type="text"]').val("");c.find('[type="file"]').val("");c.find("[data-link]").val("http://");this.dialogShowMask(c);this.dialogLockScreen();c.show()}};"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?module.exports=f:"function"===typeof define?define.amd?define(["editormd"],function(a){f(a)}):define(function(a){a=a("./../../editormd");f(a)}):f(window.editormd)})();