//相册
layer.photos({
    photos: '.photo'
    ,zIndex: 9999999999,
    shift: 5,
    shade: [0.3, '#000000']
});

//创建富文本编辑器
$(function(){
    create_rich_editor('comment_rich_editor', '', '请输入回复内容', 260, false);
});

//采纳答案
function comment_accept(comment_id){
    layer.confirm('确定采纳这条答案吗？', {icon: 3, shade:0, title:'提示'}, function(index){
        layer.load();
        $.post(
            '/api/comment/accept',
            {
                comment_id: comment_id
            },
            function(json){
                layer.closeAll('loading');
                if(json.error_code == 'ok'){
                    layer.msg('成功采纳答案');
                    setTimeout(
                        function(){
                            document.location = document.location;
                        },
                        1500
                    );
                }
                else{
                    show_error(json.error_code);
                }
            },
            'json'
        );
        layer.close(index);
    });
}

$(document).ready(function(){
    if(hljs){
        //代码高度
        hljs.initHighlightingOnLoad();

        $('pre>code').each(function(i, block) {
            hljs.highlightBlock(block);
        });
    }
    
});

//收藏文章
function article_favorite(This){
    var $this = $(This);
    var article_id = $this.attr('article_id');
    var favorited = $this.attr('favorited');

    layer.load();
    $.post(
        '/api/article/favorite',
        {
            article_id: article_id
        },
        function(json){
            layer.closeAll('loading');
            if(json.error_code == 'ok'){
                if(favorited == 0){
                    $this.attr('favorited', 1);
                    $this.attr('title', '取消收藏');
                    $('>.iconfont', $this).html('&#xe609;');
                    layer.msg('收藏成功');
                }
                else{
                    $this.attr('favorited', 0);
                    $this.attr('title', '收藏');
                    $('>.iconfont', $this).html('&#xe60a;');
                    layer.msg('收藏取消成功');
                }
            }
            else{
                show_error(json.error_code);
            }
        },
        'json'
    );
}

window._bd_share_main = false;
bd_share();
//百度分享
function bd_share(){
    //百度分享文章配置
    window._bd_share_config = {
        common : {
                    'bdSnsKey' : {'tsina' : CONFIG['weibo']['WB_AKEY']},
                    'onBeforeClick' : function(cmd, config){

                                    }
        },
        share : [
                    {
                        'tag' : 'share_article'
                    },
        ]
    };

    //以下为百度分享js加载部分
    with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
}