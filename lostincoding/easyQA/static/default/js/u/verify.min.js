//下载认证文件
function download_website_verify_file(This){
    var $this = $(This);
    var $domain = $('#domain');
    var domain = $domain.val();

    if(!simple_validate.required(domain)){
        layer.msg('请填写您要认证的网站域名');
        $domain.focus();
        return false;
    }

    if(!simple_validate.domain(domain)){
        layer.msg('域名格式错误，示例：qq.com或weixin.qq.com');
        $domain.focus();
        return false;
    }

    $this.attr('href', '/u/download_website_verify_file?domain=' + encodeURI(domain));
    layer.alert('请将下载的验证文件放到此域名网站根目录，然后点击“已上传，立即验证”按钮进行认证。', {icon:1, shade:0.3, title:'站长认证'});
    return true;
}

//站长认证
function verify_website(){
    var $domain = $('#domain');
    var domain = $domain.val();

    if(!simple_validate.required(domain)){
        layer.msg('请填写您要认证的网站域名');
        $domain.focus();
        return false;
    }

    if(!simple_validate.domain(domain)){
        layer.msg('域名格式错误，示例：qq.com或weixin.qq.com');
        $domain.focus();
        return false;
    }

    layer.confirm('确认要进行站长认证吗？如果已进行认证，新认证将替换旧认证。', {icon: 3, shade:0, title:'提示'}, function(index){
        layer.load();
        $.post(
            '/api/verify/website',
            {
                domain: domain
            },
            function(json){
                layer.closeAll('loading');
                if(json.error_code == 'ok'){
                    layer.msg('认证成功');
                    setTimeout(function(){
                        document.location = document.location;
                    }, 1500);
                }
                else{
                    show_error(json.error_code);
                }
            },
            'json'
        );
        layer.close(index);
    });

    return false;
}

//微博认证
function verify_weibo(){
    layer.confirm('确认要使用绑定的微博账号进行认证吗？如果已进行认证，新认证将替换旧认证。', {icon: 3, shade:0, title:'提示'}, function(index){
        layer.load();
        $.post(
            '/api/verify/weibo',
            {},
            function(json){
                layer.closeAll('loading');
                if(json.error_code == 'ok'){
                    layer.msg('认证成功');
                    setTimeout(function(){
                        document.location = document.location;
                    }, 1500);
                }
                else{
                    show_error(json.error_code);
                }
            },
            'json'
        );
        layer.close(index);
    });
}