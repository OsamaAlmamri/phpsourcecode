<?php defined('APP_PATH') OR exit('No direct script access allowed'); ?><div class="modal-header">	<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span>	<span class="sr-only">Close</span></button>	<h4>位置：附件列表</h4></div><div class="row">	<div class="col-lg-12">		<form action='{$public}file/index/fileList' id="list_list_form" class="form-inline" role="form">			{$ecms_hashur['form']??''}			{/* 附件类型 */}			<input type="hidden" name="type" id="type" value="{$type??''}">			<input type="hidden" name="order_by_time" id="order_by_time" value="{$order_by_time??''}">			<input type="hidden" name="order_by_size" id="order_by_size" value="{$order_by_size??''}">			<table class="table table-bordered table-hover text-left"> 				<tr>					<td>&nbsp;<span>附件筛选</span></td>					<td>						<div class="form-group">							<input name="search" type="search" class="form-control" value="{$search??''}" placeholder="请输入搜索内容">						</div>						<div class="form-group">							<input name="dosearch" type="button" value="搜索" class="btn btn-warning form-control" 								onclick="doSearch();" >&nbsp;								<?php echo (isset($search) && (!empty($search) || $search===0))?'正在搜索：'.$search:''; ?>						</div>					</td>					<td>												<div class="form-group">							<span class="text-primary form-control-static"  data-toggle="tooltip" title="注意：两种排序共存时，优先以时间排序" >排序方式</span>						</div>						<div class="form-group">							<input name="order" type="button" value="时间降序" onclick="switchOrder('desc','order_by_time');doSearch()" 								class="btn btn-{$order_by_time=='desc'?'primary':'info'} form-control">						</div>						<div class="form-group">							<input name="order" type="button" value="时间升序" onclick="switchOrder('asc','order_by_time');doSearch()" 								class="btn btn-{$order_by_time=='asc'?'primary':'info'} form-control">						</div>						<div class="form-group">							<input name="order" type="button" value="大小降序" onclick="switchOrder('desc','order_by_size');doSearch()" 								class="btn btn-{$order_by_size=='desc'?'primary':'info'} form-control">						</div>						<div class="form-group">							<input name="order" type="button" value="大小升序" onclick="switchOrder('asc','order_by_size');doSearch()" 							class="btn btn-{$order_by_size=='asc'?'primary':'info'} form-control">						</div>																		
					</td>				</tr>
			</table>
		</form>
	</div>
</div>
<div class="row">
	<div class="col-lg-12">
		<form action='{$public}file/index/editor' id="editor_form">
			{$ecms_hashur['form']??''}			<input type="hidden" name="site" id='site' value="" />			<table class="table table-bordered table-hover text-center">				<tr>					<td colspan='6' align="left"><span class="msg-select">文件列表</span></td>				</tr>				<tr>					<td width="3%">序号</td>					<td width="5%">公众号</td>					<td width="20%">昵称</td>					<td width="20%">预览</td>					<td width="6%">类别</td>					<!--<td width="6%">是否启用</td>-->					<td>操作</td>				</tr>				{volist name="list" id="file" empty="<tr><td colspan=6>暂无数据</td></tr>" }					<tr>						<td><?=$key+1?><input name="fileId[]" id="id" type="hidden" value="<?=$file['id']?>" /></td>						<td><?=$file['aid']?></td>						<td><span style="word-break:break-all;" id="list_title_<?=$key?>"><?=$file['title']?></span></td>												<td>							<?php switch($file['type']){ case '图片': ?>								<img src="<?=$file['path'].'/'.$file['name']?>" name="src[]" width="120px">							<?php break; case '涂鸦': ?>								<img src="<?=$file['path'].'/'.$file['name']?>" name="src[]" width="120px">							<?php break; case '音频': ?>								<audio src="<?=$file['path'].'/'.$file['name']?>" name="src[]" controls preload="none">您的浏览器不支持 audio 标签。</audio>							<?php break; case '视频': ?>								<video src="<?=$file['path'].'/'.$file['name']?>" poster="{$file['thumb']??''}" name="src[]" style="max-width: 250px" preload="none" controls >您的浏览器不支持 video 标签。</video>							<?php break; default: ?>								<img src="<?=$file['path'].'/'.$file['name']?>" name="src[]" width="120px" alt="如不能显示：1、图片已删；2、路径出错；3、类型不支持预览">							<?php } ?>						</td>						<td>							{$file.type??''}						</td>						<td>							<input name="thumb[]" type="hidden" id="thumb_<?=$key?>" value="<?=$file['thumb']?>">							<?php if($file['type']=='音频'){ ?>								{/* <span onclick="SelectThumb('<?=$key?>');" class="hand"><img src="templets/image/img.png" width="18" height="14" valign="middle"/>选择封面图片</span><br> */}								<div id="thumb_cover_<?=$key?>" style="display:<?=$file['thumb']?'':'none'?>">									<img src="<?=$file['thumb']?>" alt="封面图片" width="120px" height="100" id="thumb_view_<?=$key?>"/>&nbsp;<span onclick="thumb_delete('<?=$key?>');" class="hand">删除</span>								</div>							<?php } ?>							<input value="选择" type="button" class="btn btn-success" <?=$aid==$file['aid']?'':'disabled'?> onclick="file_select('<?=$key?>','<?=$file['type']?>');" >							<input type="button" class="btn btn-info" value="更多" onclick="viewMore('<?=$key?>','list_',this);">						</td>					</tr>					<tr style="display:none;" id="list_more_<?=$key?>">						<td colspan="6">							<h4>说明/备注：<small><span style="word-break:break-all;" id="list_description_<?=$key?>" ><?=$file['description']?></span></small></h4>							<p>链接：<?='http://'.$_SERVER['SERVER_NAME'].$file['path'].'/'.$file['name']?></p>							<p>大小：<?=number_format($file['size']/1024,2);?> KB； 扩展名：<?=$file['ext']?></p>							<p>更新时间：{$file.update_time??''}</p>							<p>创建时间：{$file.create_time??''}</p> 						</td>					</tr>				{/volist}
				<?php if(isset($page)){?>					<tr align="left">						<td colspan="12">							<?php echo $page;?>						</td>					</tr>				<?php }?>				</table>		</form>	</div></div><script>function file_select(site,type){	$('#myModal2').modal('hide');	var a=[];	var i=0,j=0;	var b=[];	if(type=='图片' || type=='涂鸦'){ //涂鸦与图片和并				$('#img_cover').show();		$("input[name='fileId[]']").each(function(){			b[j]=$(this).val();			j++;		});		$("img[name='src[]']").each(function(){			a[i]=$(this).attr('src');			i++;		});		$("#img_cover #img_title").html($('#list_title_'+site).html());		$("#reply_img #img").val(b[site]);		$("#img_cover img").attr('src',a[site]);	}else if(type=='音频'){ //音频		$('#voice_cover').show();		$("input[name='fileId[]']").each(function(){			b[j]=$(this).val();			j++;		});		$("audio[name='src[]']").each(function(){			a[i]=$(this).attr('src');			i++;		});		$("#voice_cover #voice_title").html($('#list_title_'+site).html());		$("#reply_voice #voice").val(b[site]);		$("#voice_cover audio").attr('src',a[site]);	}else if(type=='视频'){		$('#video_cover').show();		var thumb = [];		var k = 0;		$("input[name='fileId[]']").each(function(){			b[j]=$(this).val();			j++;		});		$("video[name='src[]']").each(function(){			a[i]=$(this).attr('src');			i++;		});		$("input[name='thumb[]']").each(function(){			thumb[k]=$(this).val();			k++;		});		$("#video_cover #video_title").html($('#list_title_'+site).html());		$("#reply_video #video").val(b[site]);		$("#video_cover video").attr('src',a[site]);		$("#video_cover video").attr('poster',thumb[site]);		//	}	}function doSearch(u){	u= u || '<?php echo url('file/index/fileList','',false)."?type=".$type.$ecms_hashur['href'];?>';	a=$('#list_list_form').serialize();	Ajax3(u,a);}function Ajax3(u,a){	$.ajax({		url:u,// ---- url路径，根据需要写,		type:'post',		data:a,		//dataType: "json",		timeout:300000,//5分钟		beforeSend:function(XMLHTTPRequest){		   //alert('远程调用开始...');		   //$("#loading").html("正在发送...");		},		success:function(data,textStatus){			editorModal2(data,'myModal2');			limitAction();		},		 error:function(XMLHTTPRequest,textStatus,errorThrown){			alert('获取数据错误；error状态文本值：'+textStatus+" 异常信息："+errorThrown);			return false;		}	});}function limitAction(){	$('form').submit(function(e){		//return false;		e.preventDefault();		doSearch();	});//必须追加该函数，否者，将会允许“Enter”键提交表单，导致模态框失效、显示错误	$('.pagination a').click(function(){		Ajax2($(this).attr('href'));		return false;	}); 	$(function () { $("[data-toggle='tooltip']").tooltip(); });}function Ajax2(u){	$.ajax({		url:u,// ---- url路径，根据需要写,		type:'get',		timeout:300000,		beforeSend:function(XMLHTTPRequest){		   //alert('远程调用开始...');		   //$("#loading").html("正在发送...");		},		success:function(data,textStatus){			editorModal2(data,'myModal2');			limitAction();		},		 error:function(XMLHTTPRequest,textStatus,errorThrown){			alert('获取数据错误；error状态文本值：'+textStatus+" 异常信息："+errorThrown);			return false;		}	});}$(function(){	$('.pagination a').click(function(){		Ajax2($(this).attr('href'));		return false;	});});function viewMore(site,type,obj){	type=type || 'list_';	if($(obj).val()=='更多'){		$('#'+type+'more_'+site).show();		$(obj).val('隐藏');	}else{		$('#'+type+'more_'+site).hide();		$(obj).val('更多');	}}function switchOrder(val,id){	var obj=$('#'+id);	var v=obj.val();	if(v==val){		obj.val('');	}else{		obj.val(val);	}}</script>