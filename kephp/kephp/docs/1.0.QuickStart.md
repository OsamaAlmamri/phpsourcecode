# kephp 快速启动

[kephp代码仓库@gitee](https://gitee.com/kephp/kephp.git)

## kephp 安装

### 项目内安装

项目已经存在（如从 git 仓库），已经初始化 composer 。

```shell
composer require kephp/kephp
composer require kephp/kephp ~version
composer require kephp/kephp ^version
composer update kephp/kephp
```

### 将 kephp 命令添加到全局环境

#### 通过 composer（kephp 使用者）

全局安装 

```shell
composer global require kephp/kephp
```

composer 没有默认将自己的 bin 输出到系统变量中，要自己手动配置：

**Mac OS**

修改bash配置文件，以下两个方式自选一个

```
nano ~/.bash_profile # 只针对当前用户
# or
nano /ect/profile    # 针对全部用户
```

添加、修改如下内容

```
export COMPOSER_GLOBAL=/Users/UserName/.composer
export COMPOSER_GLOBAL_BIN=$COMPOSER_GLOBAL/vendor/bin

# 这行根据自己的情况修改
export PATH=$COMPOSER_GLOBAL_BIN:$PATH:.
```

```shell
source ~/.bash_profile
# or
source /etc/profile
```

**Windows**

将 `C:\Users\UserName\AppData\Roaming\Composer\vendor\bin` 添加到系统环境变量的 `PATH` 中去。

**检查 kephp 是否正确安装**

执行 `kephp help` 应看到如下的内容：

```console
PHP 7.3.x, kephp 1.2.x

usage: kephp command args or php ke.php command args
kephp built-in commands: 
- new app|command|controller|view|widget|layout|model name
- server -l=listen -r=web_root
- git_export version_hash
- phar_pack dir -e=export
- scan_tables db_source
- update_model class_name -t=table_name -s=db_source
- new_model class_name -t=table_name -s=db_source
```

#### Mac OS 通过源代码（kephp 开发者）

从仓库取出源代码

```shell
git clone https://gitee.com/kephp/kephp.git
```

修改bash配置文件，以下两个方式自选一个

```shell
nano ~/.bash_profile # 只针对当前用户
# or
nano /ect/profile    # 针对全部用户
```

在文件中添加一行：

```
# /Users/UserName/Projects 是虚构的，请根据自己的实际情况来设置
export KEPHP_DEV=/Users/UserName/Projects/kephp
export KEPHP_DEV_BIN=$KEPHP_DEV/bin

# 这行根据自己的情况修改
export PATH=$KEPHP_DEV_BIN:$COMPOSER_GLOBAL_BIN:$PATH:.
```

```shell
source ~/.bash_profile
# or
source /etc/profile
```

开发者指令，使用 `kephp-dev` 。

#### Windows 通过源代码（kephp 开发者）

git 操作同 Mac OS，将源代码 clone 到指定目录，比如：`D:\Projects\kephp`，将 `D:\Projects\kephp\bin` 目录添加进系统环境变量 `PATH` 中。

开发者指令，使用 `kephp-dev.bat` 。

## 新建项目

```shell
kephp new app my_app -n=MyApp   # 创建 my_app 项目目录，项目的命名空间使用 MyApp
cd my_app
composer init                   # 初始化 composer 环境
composer require kephp/kephp    # 安装 kephp
kephp new controller index      # 建立 IndexCotnroller
kephp server                    # 启动 web server，默认 --listen=localhost:8080
```

## 区分 kephp 环境

执行 kephp 指令时，会尝试优先加载当前目录下的 kephp 版本。

以上述的环境为例，同时存在 global/vendor/kephp (通过 composer 或者 源代码) 和 my_app/vendor/kephp 两个类库。

当用户在 my_app 目录下执行 kephp 指令时，会优先使用 my_app/vendor/kephp （版本号区分）。

### 指定使用全局的 kephp

针对 kephp 类库开发升级时，需要可以调用全局环境下的 kephp (global/vendor/kephp)

```shell
export KEPHP_GLOBAL=1   # linux/mac
SET KEPHP_GLOBAL=1      # windows
```

## 推荐阅读

- [composer 指北](9.1.ComposerSkills.md)
- [kephp 内建命令说明](1.1.BuiltInCommands.md)

